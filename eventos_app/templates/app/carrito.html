{% extends "base.html" %}

{% block title %}Carrito de Compras{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h1 class="mb-4">Carrito de Compras</h1>
    <div class="d-flex flex-column flex-md-row align-items-start justify-content-between gap-4 mb-4">
      
      <!-- Izquierda: título y detalles del evento -->
      <div style="flex: 1;">
        <h3>{{ event.title }}</h3>
        <p><strong>Fecha:</strong> {{ event.date }}</p>
        <p><strong>Lugar:</strong> {{ event.venue }}</p>
        <p><strong>Precio General:</strong> ${{ event.price|floatformat:2 }}</p>
        <p><strong>Precio VIP (Recargo 25%):</strong> ${{ tickets_vip }}</p>
        <p><strong>Descripción:</strong> {{ event.description }}</p>
        <p><strong>Tickets restantes:</strong> {{ tickets_restantes }}</p>
      </div>

      <!-- Derecha: formulario -->
      <div style="flex: 1; max-width: 450px;">
        <form method="post">
          {% csrf_token %}

          <div class="row mb-3 align-items-center">
            <div class="col d-flex flex-column">
              <label for="cantidad_general" class="form-label">Cantidad de tickets GENERAL:</label>
              <input type="number" name="cantidad_general" id="cantidad_general" value="0" min="0" class="form-control" onchange="actualizarTotal()">
            </div>
            <div class="col d-flex flex-column">
              <label for="cantidad_vip" class="form-label">Cantidad de tickets VIP:</label>
              <input type="number" name="cantidad_vip" id="cantidad_vip" value="0" min="0" class="form-control" onchange="actualizarTotal()">
            </div>
          </div>

          <hr>

          <h3>Datos de la tarjeta</h3>

          <div class="mb-3">
            {{ form.nombre_titular.label_tag }}
            {{ form.nombre_titular }}
            {% if form.nombre_titular.errors %}
              <div class="text-danger">{{ form.nombre_titular.errors }}</div>
            {% endif %}
          </div>

      <div class="mb-3">
        {{ form.numero_tarjeta.label_tag }}
        {{ form.numero_tarjeta }}
        {% if form.numero_tarjeta.errors %}
          <div class="text-danger">{{ form.numero_tarjeta.errors }}</div>
        {% endif %}
      </div>

          <div class="mb-3">
            {{ form.fecha_vencimiento.label_tag }}
            {{ form.fecha_vencimiento }}
            {% if form.fecha_vencimiento.errors %}
              <div class="text-danger">{{ form.fecha_vencimiento.errors }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            {{ form.cvv.label_tag }}
            {{ form.cvv }}
            {% if form.cvv.errors %}
              <div class="text-danger">{{ form.cvv.errors }}</div>
            {% endif %}
          </div>

          <hr>

          <h4>Total a pagar: <span id="total-a-pagar">$0.00</span></h4>
          <button type="submit" class="btn btn-success mt-2">Comprar</button>
        </form>
      </div>
    </div> <!-- cierra el d-flex -->

    <script>
      function actualizarTotal() {
        // Obtener los precios del template
        const precioGeneral = parseFloat("{{ event.price }}");
        const precioVip = parseFloat("{{ tickets_vip }}");

        // Obtenemos las cantidades de los inputs
        const cantidadGeneral = parseInt(document.getElementById('cantidad_general').value) || 0;
        const cantidadVip = parseInt(document.getElementById('cantidad_vip').value) || 0;

        // Calculamos el total
        const total = (cantidadGeneral * precioGeneral) + (cantidadVip * precioVip);

        // Actualizamos el texto en la página
        document.getElementById('total-a-pagar').innerText = '$' + total.toFixed(2);
      }

      // Llama a la función una vez al cargar la página para inicializar el total
      document.addEventListener('DOMContentLoaded', actualizarTotal);
    </script>
  </div> <!-- cierra el container -->
{% endblock %}
